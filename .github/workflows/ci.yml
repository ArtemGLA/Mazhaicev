name: CI Pipeline - Build Stage

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    # –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞ Ubuntu (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–Ω–Ω–µ—Ä GitHub)
    runs-on: ubuntu-latest
    
    # –®–∞–≥–∏ —Å–±–æ—Ä–∫–∏
    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Checkout code
        uses: actions/checkout@v4
      
      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            g++ \
            make \
            # –î–æ–±–∞–≤—å —Å—é–¥–∞ –¥—Ä—É–≥–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã
            # –ù–∞–ø—Ä–∏–º–µ—Ä: libssl-dev, libsqlite3-dev –∏ —Ç.–¥.
      
      # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ (–∫–∞–∫ –≤ —Ç–≤–æ–µ–º –∑–∞–¥–∞–Ω–∏–∏ –ø—Ä–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
      - name: Check compiler version
        run: |
          g++ --version
          make --version
          echo "‚úÖ –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ make —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
      
      # 4. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
      - name: Build program with make
        working-directory: ./src  # –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ–º –≤ –ø–∞–ø–∫–µ src
        run: |
          echo "üî® –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É –ø—Ä–æ–≥—Ä–∞–º–º—ã..."
          make clean  # –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å–±–æ—Ä–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å —Ü–µ–ª—å clean)
          make        # –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è
          if [ -f myprogram ]; then  # –∑–∞–º–µ–Ω–∏ myprogram –Ω–∞ –∏–º—è —Ç–≤–æ–µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
            echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞! –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω"
            ls -la myprogram
          else
            echo "‚ùå –û—à–∏–±–∫–∞: –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"
            exit 1
          fi
      
      # 5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏
      - name: List build artifacts
        working-directory: ./src
        run: |
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ src –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏:"
          ls -la
      
      # 6. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: built-program
          path: src/myprogram  # –∑–∞–º–µ–Ω–∏ –Ω–∞ –ø—É—Ç—å –∫ —Ç–≤–æ–µ–º—É –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É
          retention-days: 7     # —Ö—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç 7 –¥–Ω–µ–π
