name: CI Pipeline - Build Stage

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            build-essential \
            g++ \
            make \
      
      - name: Check compiler version
        run: |
          g++ --version
          make --version
          echo "‚úÖ –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ make —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
      
      - name: Build program with make
        working-directory: ./src
        run: |
          echo "üî® –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É –ø—Ä–æ–≥—Ä–∞–º–º—ã..."
          make
        
      - name: Check compiler version
        working-directory: ./usr/bin
        run: |
          if [ -f hello ]; then
            echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞! –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω"
          else
            echo "‚ùå –û—à–∏–±–∫–∞: –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω!"
            exit 1
          fi
      
      - name: List build artifacts
        working-directory: ./src
        run: |
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ src –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏:"
          ls -la
      
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: built-program
          path: src/myprogram
          retention-days: 7
